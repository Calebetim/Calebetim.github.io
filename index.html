<script>
  const roadmap = [
    {
      title: "Semana 1 a 2 – Fundamentos do Flutter e Dart",
      items: [
        "Instalar Flutter e configurar o ambiente de desenvolvimento",
        "Compreender a estrutura de um app Flutter",
        "Estudar widgets básicos: Text, Image, Column, Row, Container",
        "Aprender fundamentos de Dart: variáveis, funções, classes, tipos, null safety",
        "Projeto: App de boas-vindas com layout simples e campos de entrada"
      ]
    },
    // ... demais semanas (copie da sua versão anterior)
  ];

  const container = document.getElementById("roadmap");

  function getProgress() {
    return JSON.parse(localStorage.getItem("flutterRoadmapProgress") || "{}");
  }

  function saveProgress(progress) {
    localStorage.setItem("flutterRoadmapProgress", JSON.stringify(progress));
  }

  const progress = getProgress();

  roadmap.forEach((section, sectionIndex) => {
    const sectionKey = `section-${sectionIndex}`;
    const sectionProgress = progress[sectionKey] || [];

    const card = document.createElement("div");
    card.className = "border rounded-lg mb-4 bg-white shadow";

    const header = document.createElement("button");
    header.className = "w-full px-4 py-3 bg-gray-100 hover:bg-gray-200 text-left font-semibold text-lg flex justify-between items-center";
    header.innerHTML = `<span>${section.title}</span><span class="status"></span>`;
    const statusSpan = header.querySelector(".status");
    const list = document.createElement("ul");
    list.className = "p-4 space-y-2 hidden";

    function updateSectionStatus() {
      const allChecked = [...list.querySelectorAll("input")].every(cb => cb.checked);
      if (allChecked) {
        card.classList.add("border-green-500");
        statusSpan.textContent = "✅";
      } else {
        card.classList.remove("border-green-500");
        statusSpan.textContent = "";
      }
    }

    header.onclick = () => list.classList.toggle("hidden");

    section.items.forEach((item, itemIndex) => {
      const li = document.createElement("li");
      li.className = "flex items-center space-x-2";

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.className = "accent-blue-600";
      checkbox.checked = sectionProgress[itemIndex] || false;

      const label = document.createElement("span");
      label.textContent = item;
      if (checkbox.checked) label.classList.add("line-through", "text-gray-500");

      checkbox.onchange = () => {
        if (checkbox.checked) {
          label.classList.add("line-through", "text-gray-500");
        } else {
          label.classList.remove("line-through", "text-gray-500");
        }

        sectionProgress[itemIndex] = checkbox.checked;
        progress[sectionKey] = sectionProgress;
        saveProgress(progress);
        updateSectionStatus();
      };

      li.appendChild(checkbox);
      li.appendChild(label);
      list.appendChild(li);
    });

    card.appendChild(header);
    card.appendChild(list);
    container.appendChild(card);

    updateSectionStatus(); // aplicar status na carga
  });
</script>
